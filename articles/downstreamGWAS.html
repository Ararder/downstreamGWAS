<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>downstreamGWAS â€¢ downstreamGWAS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="downstreamGWAS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">downstreamGWAS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/downstreamGWAS.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/meta-analysis.html">meta-analysis</a></li>
    <li><a class="dropdown-item" href="../articles/multi-file-datasets.html">multi-file datasets</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>downstreamGWAS</h1>
            
      

      <div class="d-none name"><code>downstreamGWAS.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://arvidharder.com/downstreamGWAS/">downstreamGWAS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://arvidharder.com/tidyGWAS/" class="external-link">tidyGWAS</a></span><span class="op">)</span></span></code></pre></div>
<p>downstreamGWAS has to ambition make standardized pipelines for
downstream analysis that has genome-wide summary statistics as
<strong><em>primary input</em></strong>. Examples of these types of
analysis are: gene-based tests (with magma or GCTA), or heritability
enrichment (with S-LDSC). The required input for these analyses can
typically be put into one of three categories:</p>
<ol style="list-style-type: decimal">
<li><p>summary statistics</p></li>
<li><p>reference data</p></li>
<li><p>software dependencies</p></li>
</ol>
<p>downstreamGWAS is aimed at making this painless and reproducible.
Each part is tackled in the following way:</p>
<div class="section level4">
<h4 id="summary-statistics">(1) Summary statistics<a class="anchor" aria-label="anchor" href="#summary-statistics"></a>
</h4>
<p>downstreamGWAS relies on summary statistics first being cleaned by
<code><a href="http://arvidharder.com/tidyGWAS/reference/tidyGWAS.html" class="external-link">tidyGWAS::tidyGWAS()</a></code>, and assumes that
<code>output_format="hivestyle"</code> (the default argument), and that
no changes has been made to the resulting folder structure.</p>
<p>With standardized column names and data formats, the functionality to
prepare the summary statistics for the downstream analysis can be
continously reused. For example, the <a href="https://cnsgenomics.com/software/gctb/#Overview" class="external-link">GCTB</a> suite of
genetic analysis uses the .ma format, and downstreamGWAS has defined
method for converting tidyGWAS to .ma in
<code><a href="../reference/to_ma.html">downstreamGWAS::to_ma()</a></code>. No need to write new code each
time!</p>
<p>A common (and very time consuming step) is to first munge summary
statistics, and prepare them with correct filters, column names and
data-types. downstreamGWAS uses the standardized tidyGWAS output to
automate this munging step, for example
<code><a href="../reference/to_ma.html">downstreamGWAS::to_ma()</a></code> or
<code><a href="../reference/to_ldsc.html">downstreamGWAS::to_ldsc()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="reference-data">(2) Reference data<a class="anchor" aria-label="anchor" href="#reference-data"></a>
</h4>
<p>Another common issue is acquiring and using the same reference data
for analysis. downstreamGWAS uses <a href="https://zenodo.org" class="external-link">Zenodo</a> to host and share reference data
where it is possible. This makes it easy to reproduce your results
across computational clusters and research groups. See for example the
reference files for running stratified LDscore regression <a href="https://zenodo.org/records/8367200" class="external-link">here</a>.</p>
</div>
<div class="section level4">
<h4 id="software-dependencies">(3) Software dependencies<a class="anchor" aria-label="anchor" href="#software-dependencies"></a>
</h4>
<p>Software can be difficult to install properly, especially when you
are working on high performance clusters where you might not have enough
permissions. To handle this, downstreamGWAS makes use of the software
container <a href="https://apptainer.org" class="external-link">apptainer</a>. Apptainer can
use <a href="https://www.docker.com" class="external-link">Docker</a> images to produce a
virtual environment, where sudo privileges are not required. For the
downstream analysis implemented in downstreamGWAS, we have created
docker images for each.</p>
<p>This virtualization also serves as another important factor in
reproductibility, making sure analysis is conducted using the same
underlying software.</p>
</div>
<div class="section level3">
<h3 id="setting-up-downstreamgwas">Setting up downstreamGWAS<a class="anchor" aria-label="anchor" href="#setting-up-downstreamgwas"></a>
</h3>
<p>To illustrate the results, we first create an toy example of a
cleaned tidyGWAS sumstat.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sumstats</span> <span class="op">&lt;-</span> <span class="fu">tidyGWAS</span><span class="fu">::</span><span class="va">test_file</span></span>
<span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://arvidharder.com/tidyGWAS/reference/tidyGWAS.html" class="external-link">tidyGWAS</a></span><span class="op">(</span></span>
<span>  <span class="co"># Here we input the summary statistics as a data.frame already in R memory</span></span>
<span>  tbl <span class="op">=</span> <span class="va">sumstats</span>, </span>
<span>  <span class="co"># provide the filepath to the refence files you downloaded.</span></span>
<span>  dbsnp_path <span class="op">=</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html" class="external-link">path_package</a></span><span class="op">(</span><span class="st">"tidyGWAS"</span><span class="op">)</span>, <span class="st">"extdata/dbSNP155"</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"example_gwas"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Using only the filepath to output_folder, downstreamGWAS can generate
a slurm script to run the specific downstream analysis. Here for
example, a script to run <a href="https://github.com/zhilizheng/SBayesRC" class="external-link">SbayesRC</a> is created,
ready to run.</p>
<div class="section level4">
<h4 id="running-sbayesrc">Running SbayesRC<a class="anchor" aria-label="anchor" href="#running-sbayesrc"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># downstreamGWAS uses the "HOME" variable to store data on where you keep the reference files between sessions. </span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html" class="external-link">local_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"HOME"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dsg_folder</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"downstreamGWAS_folder"</span><span class="op">)</span></span>
<span><span class="co"># use setup to tell downstreamGWAS where the reference data and containers are kept</span></span>
<span><span class="co"># only has to be done once</span></span>
<span><span class="fu"><a href="../reference/setup.html">setup</a></span><span class="op">(</span><span class="va">dsg_folder</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/run_sbayesrc.html">run_sbayesrc</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"example_gwas"</span><span class="op">)</span>,  write_script <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cell-type-analysis-using-s-ldsc">cell-type analysis using S-LDSC<a class="anchor" aria-label="anchor" href="#cell-type-analysis-using-s-ldsc"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">run_sldsc_cts</span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"example_gwas"</span><span class="op">)</span>,cts_file <span class="op">=</span> <span class="st">"toy.cts"</span>, write_script <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="setting-up-downstreamgwas-1">Setting up downstreamGWAS<a class="anchor" aria-label="anchor" href="#setting-up-downstreamgwas-1"></a>
</h2>
<p>WORK IN PROGRESS</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
